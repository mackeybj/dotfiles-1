# ==============================================================================
# = paradigm's_mutt_settings                                                   =
# ==============================================================================

# ==============================================================================
# = general_settings                                                           =
# ==============================================================================

# Directory which contains all of the mailboxes
set folder="~/.mail/"
# source additional information which should not be tracked by public git
source ~/.decrypted/mailboxes
# smtp client
set sendmail = "/usr/bin/msmtp"
set use_from = yes
set envelope_from = yes

# include headers when editing
set edit_headers
# indicate I'm using mutt
set user_agent
# quit without confirmation
set quit
# mutt's temp file directory
set tmpdir = ~/.mutt/temp
# include messages in replies
set include
# keep sent messages
set copy = yes
# vi-style tildes in pager
set tilde
# prefer plain text over html
alternative_order text/plain text/html
# enable ssl
set ssl_ca_certificates_file=/etc/ssl/certs/ca-certificates.crt
set ssl_starttls
set ssl_force_tls
# have Vim start editing after header
set editor = 'vim "+:silent" "+/^$"  "+:noh" "+:normal! o" "+:startinsert"'

# when starting mutt, default to choosing which mailbox to use
#push c?<tab>

# ==============================================================================
# = key_bindings                                                               =
# ==============================================================================

# browser is file browser

# Navigate the side bar (requires mutt-patched/mutt-sidebar)
bind index,pager \Cy sidebar-prev
bind index,pager \Ce sidebar-next
bind index,pager \C] sidebar-open

bind pager               gg  top
bind index               gg  first-entry
bind pager               G   bottom
bind index               G   last-entry

bind index               H   current-top
bind index               M   current-middle
bind index               L   current-bottom
bind pager               j   next-line
bind pager               k   previous-line

bind generic \Cd half-down
bind generic \Cu half-up
bind generic \Cb previous-page
bind generic \Cf next-page

bind pager               R   group-reply
macro index              C   c<tab>

# open html e-mail in external browser
macro pager              o   <pipe-entry>'elinks -force-html'<enter> 'open message in elinks'
macro pager              O   <pipe-entry>'tee >/dev/shm/tempemail.html && firefox /dev/shm/tempemail.html && rm /dev/shm/tempemail.html'<enter> 'open message in firefox'

# ==============================================================================
# = theme                                                                      =
# ==============================================================================


# main colors
color normal `awk -F'[= ]' '/^MISCELLANEOUS_FOREGROUND=/{fg=$2}/^MISCELLANEOUS_BACKGROUND=/{bg=$2}END{print"color"fg" color"bg}' ~/.themes/current/terminal/256-theme`
# '└─>' reply indicator
color tree `awk -F'[= ]' '/^MISCELLANEOUS_FOREGROUND=/{fg=$2}/^MISCELLANEOUS_BACKGROUND=/{bg=$2}END{print"color"fg" color"bg}' ~/.themes/current/terminal/256-theme`
# chrome
color status `awk -F'[= ]' '/^INSENSITIVE_FOREGROUND=/{fg=$2}/^INSENSITIVE_BACKGROUND=/{bg=$2}END{print"color"fg" color"bg}' ~/.themes/current/terminal/256-theme`
# selected item
color indicator `awk -F'[= ]' '/^HIGHLIGHT_FOREGROUND=/{fg=$2}/^HIGHLIGHT_BACKGROUND=/{bg=$2}END{print"color"fg" color"bg}' ~/.themes/current/terminal/256-theme`
# Header items
color header `awk -F'[= ]' '/^INSENSITIVE_FOREGROUND=/{fg=$2}/^INSENSITIVE_BACKGROUND=/{bg=$2}END{print"color"fg" color"bg}' ~/.themes/current/terminal/256-theme` '.*'
# Normal highlighting for subject and from fields
color header white black '(Subject|From): .*'
color header `awk -F'[= ]' '/^NORMAL_FOREGROUND=/{fg=$2}/^NORMAL_BACKGROUND=/{bg=$2}END{print"color"fg" color"bg}' ~/.themes/current/terminal/256-theme` '(Subject|From): .*'
# body
color body `awk -F'[= ]' '/^NORMAL_FOREGROUND=/{fg=$2}/^NORMAL_BACKGROUND=/{bg=$2}END{print"color"fg" color"bg}' ~/.themes/current/terminal/256-theme` ".*"
# GPG
color body `awk -F'[= ]' '/^HIGHLIGHT_FOREGROUND=/{fg=$2}/^HIGHLIGHT_BACKGROUND=/{bg=$2}END{print"color"fg" color"bg}' ~/.themes/current/terminal/256-theme` "^gpg: Good signature .*"
color body `awk -F'[= ]' '/^ERROR_FOREGROUND=/{fg=$2}/^ERROR_BACKGROUND=/{bg=$2}END{print"color"fg" color"bg}' ~/.themes/current/terminal/256-theme` "^gpg: BAD signature from.*"
# index pgp
#color index `awk -F'[= ]' '/^HIGHLIGHT_FOREGROUND=/{fg=$2}/^HIGHLIGHT_BACKGROUND=/{bg=$2}END{print"color"fg" color"bg}' ~/.themes/current/terminal/256-theme` '~k'
# index unread emails
color index `awk -F'[= ]' '/^NORMAL_FOREGROUND=/{fg=$2}/^NORMAL_BACKGROUND=/{bg=$2}END{print"color"fg" color"bg}' ~/.themes/current/terminal/256-theme` '~U'
# index about-to-be deleted emails
color index `awk -F'[= ]' '/^ERROR_FOREGROUND=/{fg=$2}/^ERROR_BACKGROUND=/{bg=$2}END{print"color"fg" color"bg}' ~/.themes/current/terminal/256-theme` '~D'
# index tagged emails
color index `awk -F'[= ]' '/^HIGHLIGHT_FOREGROUND=/{fg=$2}/^HIGHLIGHT_BACKGROUND=/{bg=$2}END{print"color"fg" color"bg}' ~/.themes/current/terminal/256-theme` '~T'

# ==============================================================================
#  pgp/gpg
# ==============================================================================

set pgp_decode_command="gpg %?p?--passphrase-fd 0? --no-verbose --batch --output - %f"
set pgp_verify_command="gpg --no-verbose --batch --output - --verify %s %f"
set pgp_decrypt_command="gpg --passphrase-fd 0 --no-verbose --batch --output - %f"
set pgp_sign_command="gpg --no-verbose --batch --output - --passphrase-fd 0 --armor --detach-sign --textmode %?a?-u %a? %f"
set pgp_clearsign_command="gpg --no-verbose --batch --output - --passphrase-fd 0 --armor --textmode --clearsign %?a?-u %a? %f"
set pgp_import_command="gpg --no-verbose --import -v %f"
set pgp_export_command="gpg --no-verbose --export --armor %r"
set pgp_verify_key_command="gpg --no-verbose --batch --fingerprint --check-sigs %r"
set pgp_list_pubring_command="gpg --no-verbose --batch --with-colons --list-keys %r" 
set pgp_list_secring_command="gpg --no-verbose --batch --with-colons --list-secret-keys %r" 
set pgp_autosign=yes                          # automatically sign all outgoing mail
set pgp_sign_as=98F7B207                      # my key
set pgp_timeout=60                            # cache password for one minute
set pgp_good_sign="^gpg: Good signature from" # good signiture notice
set crypt_verify_sig=yes                      # automatically verify the sign of a message when opened
set crypt_replysignencrypted=yes              # automatically encrypt when replying to encrypted
